/*! ubc-virtual-tour v0.5.0 | (c) Hugh Coleman */

function initialize() {
    function b(fa) {
        "object" == typeof fa && (fa = document.getElementById("dialog-text").innerHTML), document.getElementById("dialog-text").innerHTML = fa, document.getElementById("dialog").style.display = "block"
    }

    function d() {
        if (!0 == N.getVisible()) {
            var fa, ga = N.getPosition();
            for (i = 0; i < U.length; i++) fa = google.maps.geometry.spherical.computeDistanceBetween(ga, V[i]), 25 > fa ? U[i].setMap(N) : U[i].setMap(null);
            O.setVisible(!1), x();
            var ha = W + 1;
            fa = google.maps.geometry.spherical.computeDistanceBetween(ga, V[W]), u("Distance to waypoint #" + ha + " : " + fa.toFixed() + "m"), H(ha), S = N.getPosition(), 150 > fa && 2 == W && 0 == I && (b("Well done! You're getting closer to stage 3... here's a bonus clue from my trip there!<br /><br /><img src='clues/haida.png' width='100%' height='100%' />"), I = 1), 70 > fa && 3 == W && 0 == J && (b("Well done! You're getting closer to stage 4... here's a bonus clue from my trip there!<br /><br /><img src='clues/whale.png' width='100%' height='100%' />"), J = 1), 800 > fa && 4 == W && 0 == K && (b("Well done! You're getting closer to stage 5... here's a bonus clue from my trip there!<br /><br /><img src='clues/doughnut.png' width='100%' height='100%' />"), K = 1)
        } else {
            for (i = 0; i < U.length; i++) U[i].setMap(null);
            s(), o("To follow in Signal's steps, switch to Street View mode."), O.setMap(M), O.setPosition(S), O.setVisible(!0)
        }
    }

    function k(fa, ga, ha) {
        google.maps.event.addListener(fa, "click", function() {
            ha + 1 == Q ? n() : (W = ha + 1, d()), b(P[ha].clue)
        })
    }

    function n() {
        var fa = Math.round(new Date().getTime() / 1e3);
        A(fa - L)
    }

    function o(fa) {
        var ga = document.createElement("div");
        M.controls[google.maps.ControlPosition.BOTTOM_CENTER].clear(), ga.style.padding = "15px";
        var ha = document.createElement("div");
        ha.style.backgroundColor = "red", ha.style.opacity = 0.8, ha.style.cursor = "pointer", ha.style.textAlign = "center", ha.title = "message", ga.appendChild(ha);
        var ia = document.createElement("div");
        ia.style.fontFamily = "Arial,sans-serif", ia.style.color = "white", ia.style.fontSize = "16px", ia.style.paddingLeft = "8px", ia.style.paddingRight = "8px", ia.innerHTML = "<strong>" + fa + "</strong>", ha.appendChild(ia), M.controls[google.maps.ControlPosition.BOTTOM_CENTER].push(ga), google.maps.event.trigger(M, "resize")
    }

    function s() {
        M.controls[google.maps.ControlPosition.BOTTOM_CENTER].clear(), google.maps.event.trigger(M, "resize")
    }

    function u(fa) {
        var ga = document.createElement("div");
        N.controls[google.maps.ControlPosition.TOP_CENTER].clear(), ga.style.padding = "15px";
        var ha = document.createElement("div");
        ha.style.backgroundColor = "blue", ha.style.opacity = 0.8, ha.style.cursor = "pointer", ha.style.textAlign = "center", ha.title = "message", ga.appendChild(ha);
        var ia = document.createElement("div");
        ia.style.fontFamily = "Arial,sans-serif", ia.style.color = "white", ia.style.fontSize = "16px", ia.style.paddingLeft = "8px", ia.style.paddingRight = "8px", ia.innerHTML = "<strong>" + fa + "</strong>", ha.appendChild(ia), N.controls[google.maps.ControlPosition.TOP_CENTER].push(ga), google.maps.event.trigger(N, "resize")
    }

    function x() {
        N.controls[google.maps.ControlPosition.TOP_CENTER].clear(), google.maps.event.trigger(N, "resize")
    }

    function A(fa) {
        var ga = new XMLHttpRequest;
        ga.addEventListener("load", function() {
            console.log("Counted!")
        }), ga.open("GET", "https://geocaching.kumaneko.ca/gc7h5j2/portal.php?time=" + fa), ga.send()
    }

    function H(fa) {
        for (i = 0; i < U.length; i++) i == fa - 1 ? U[i].setVisible(!0) : U[i].setVisible(!1)
    }
    var I = 0,
        J = 0,
        K = 0;
    document.getElementById("rescueMe").addEventListener("click", function() {
        var fa = confirm("Due to glitches within Google Maps, it is possible to get stuck in a spot and not be able to escape. \n\nIf you are stuck, click on OK to be sent back to the UBC sign. Your progress won't be reset, but you will have to trek back to where you were. \n\nClick cancel if you aren't stuck.");
        fa && N.setPosition(new google.maps.LatLng(49.2664151, -123.245081))
    }), document.getElementById("hide-dialog").addEventListener("click", function() {
        document.getElementById("dialog").style.display = "none"
    }), document.getElementById("signal-stuffie").addEventListener("click", b);
    var L = Math.round(new Date().getTime() / 1e3),
        M, N, O, P = [{
            lat: 49.266272,
            lng: -123.245802,
            name: "#1 - Welcome to Yew-Bee-Cee!",
            clue: "Well done on finding stage 1! <br /><br />I remember walking around stage 2 and hearing some 'Encore!'s... or maybe it was some violins... it was en<i>chan</i>tingly beautiful."
        }, {
            lat: 49.269333,
            lng: -123.25519,
            name: "#2 - Chan Centre",
            clue: "Well done on finding stage 2! <br /><br />I remember seeing a First Nations house while placing the stage 3 cache, along with some beautiful traditional art...<br /><br />By the way, did I mention that you can click on me at anytime to view your last hint?"
        }, {
            lat: 49.269089,
            lng: -123.260738,
            name: "#3 - UBC Anthropology Museum & Haida House",
            clue: "Well done on finding stage 3! <br /><br />Hmm... I believe I saw a Great Blue Whale Skeleton as I was placing stage 4..."
        }, {
            lat: 49.263171,
            lng: -123.251299,
            name: "#4 - Beaty Biodiversity Museum",
            clue: "Well done on finding stage 4! <br /><br />I think I saw a giant, giant doughnut with cars going around it at stage 5."
        }, {
            lat: 49.255756,
            lng: -123.236365,
            name: "#5 - The Roundabout",
            clue: "Well done on finding stage 5! <br /><br />I remember some people telling me about crashing particles together or something. They were quite <i>triumph</i>ant about their work."
        }, {
            lat: 49.247693,
            lng: -123.231733,
            name: "#6 - TRIUMF Particle Accelerator",
            clue: "Well done on finding stage 6! <br /><br />There were people picking some vegtables at the stage 7 GZ, along with a gathering of farmers, I believe. They were tasty!"
        }, {
            lat: 49.250749,
            lng: -123.237467,
            name: "#7 - UBC Farm",
            clue: "Well done on finding stage 7! <br /><br />I remember seeing some beautiful plants in a garden, while I was looking for a spot for stage 8..."
        }, {
            lat: 49.254297,
            lng: -123.250023,
            name: "Final Stage - UBC Botanical Garden",
            clue: "Congrats! You just completed the UBC Virtual Tour!<br /><br /><center>The physical cache is located at:<br><img src='https://i.imgur.com/8RAzDtz.png'><br /><i>Now, go get it!</i></center>"
        }],
        Q = P.length,
        R = new google.maps.LatLng(49.2664151, -123.245081),
        S = new google.maps.LatLng(49.2664151, -123.245081),
        T = {
            center: R,
            zoom: 17,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        },
        U = [],
        V = [],
        W = 0;
    M = new google.maps.Map(document.getElementById("map_canvas"), T), N = M.getStreetView(), N.setOptions({
        addressControl: !1
    }), N.setPosition(R), N.setPov({
        heading: 254.89,
        pitch: 1
    }), N.setVisible(!0);
    var X;
    for (i = 0; i < Q; i++) {
        X = i == Q - 1 ? "" : "<center>You found: <br><font color=\"green\">" + P[i].name + "</font> <br><hr>Signal says: <br><font color=\"blue\">" + P[i].clue + "</font> <br></center>";
        var aa = new google.maps.InfoWindow({
            content: X
        });
        V[i] = new google.maps.LatLng(P[i].lat, P[i].lng);
        var ea = new google.maps.Marker({
            position: V[i],
            map: N,
            title: P[i].name,
            icon: "tupperware.png"
        });
        U.push(ea), k(ea, aa, i)
    }
    O = new google.maps.Marker({
        position: S,
        map: M,
        title: "Last Position",
        visible: !1
    }), google.maps.event.addListener(N, "visible_changed", function() {
        d()
    }), google.maps.event.addListener(N, "position_changed", function() {
        d()
    })
}

/**
 * Special thanks to kondo3d for the puzzle idea and original script. See his caches at:
 * 
 * coord.info/GC4AQ1F - Virtual Hunt #1: Nagoya Station
 * coord.info/GC5NM23 - Virtual Hunt #2: World Heritage
 */
  
